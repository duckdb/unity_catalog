# name: test/sql/databricks/write_tests/write.test
# description: test
# group: [write_tests]

# Require statement will ensure this test is run with this extension loaded
require parquet

require unity_catalog

require delta

require httpfs

require-env DATABRICKS_TOKEN

require-env DATABRICKS_ENDPOINT

require-env DATABRICKS_REGION

require-env DATABRICKS_WRITE_TEST_CATALOG

require-env DATABRICKS_WRITE_TEST_SCHEMA

statement ok
CREATE SECRET (
    TYPE UC,
    TOKEN '${DATABRICKS_TOKEN}',
    ENDPOINT '${DATABRICKS_ENDPOINT}',
    AWS_REGION '${DATABRICKS_REGION}'
);

# Attach to databricks through the unity catalog API
statement ok
ATTACH '${DATABRICKS_WRITE_TEST_CATALOG}' as databricks_catalog (TYPE UNITY_CATALOG, DEFAULT_SCHEMA '${DATABRICKS_WRITE_TEST_SCHEMA}');

statement ok
USE databricks_catalog;

query II
SELECT * FROM simple_table ORDER BY id
----
0	value-0
1	value-1
2	value-2
3	value-3
4	value-4

statement ok
INSERT INTO simple_table VALUES (5, 'value-5');

query II
SELECT * FROM simple_table ORDER BY id
----
0	value-0
1	value-1
2	value-2
3	value-3
4	value-4
5	value-5
